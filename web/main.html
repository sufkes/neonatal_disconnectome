<!DOCTYPE html>
<html>

<head>
  <title>Disconnectome</title>
  <!-- Include eel.js - note this file doesn't exist in the 'web' directory -->
  <script type="text/javascript" src="/eel.js"></script>
  <link rel="stylesheet" href="css/fontello.css">
  <link rel="stylesheet" href="css/picnic.css">
  <link rel="stylesheet" href="css/main.css">
</head>

<body>
  <div id="app">
    <nav>
      <a href="main.html" class="brand">
        <img class="logo" src="/img/logo.png" />
        <span>Neonatal Disconnectome</span>
      </a>
      <!-- responsive-->
      <input id="bmenub" type="checkbox" class="show">
      <label for="bmenub" class="burger pseudo button">menu</label>

      <div class="menu">
        <a href="main.html">Start a new run</a>
        <a href="https://github.com/sufkes/neonatal_disconnectome" target="_blank"
          class="pseudo button icon-github-circled">GitHub</a>
        <!-- <button onclick="showLoading()">Show dialog</button> -->
      </div>
    </nav>
    <main class="content">
      <dialog id="loadingModal">
        <header>
          <h3>Computing Result <span id="loadingModalLabel" class="label error hide">Error</span></h3>
          <label id="loadingModalClose" class="close hide" onclick="stopLoading()">&times;</label>
        </header>
        <section id="loadingModalContent">
        </section>
        <footer>
          <div class="spinner">
          </div>
        </footer>
      </dialog>
      <article id="mainContainer" class="card">
        <header>
          <h2 id="formHeaderText">Start a new run</h2>
          <button class="next" id="next" form="startNewRunForm">Next</button>
        </header>
        <form class="row active" id="startNewRunForm">
          <div class="form-group">
            <label class="stack" for="runsFolder">
              Please select the folder where the output for this run will be saved to
            </label>
            <div class="file">
              <div id="runsFolderButton" class="fileButton" onclick="getFolder(event)">Browse...</div>
              <input class="fileInput" type="text" name="runsFolder" id="runsFolder" placeholder="No folder selected."
                required autocomplete="off" onkeydown="return false;" onpaste="return false;" ondrop="return false;" />
            </div>
            <div class="error" id="runsFolderError" role="alert">Please enter a valid runs folder</div>
          </div>
          <div class="form-group">
            <legend>Is the lesion map already warped to DHCP template image?</legend>
            <label for="yes">
              <input type="radio" value="yes" name="skipStep1" id="yes" required />
              <span class="checkable">YES</span>
            </label>
            <label for="no">
              <input type="radio" value="no" name="skipStep1" id="no" required />
              <span class="checkable">NO</span>
            </label>
            <div class="error" id="skipStep1Error" role="alert">Please select an option</div>
          </div>
        </form>
        <form id="warpSubjectToAgeMatchedForm" enctype="multipart/form-data">
          <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <div class="progress-fill"></div>
          </div>
          <h4>Image Data</h4>
          <div class="form-group">
            <label for="3DBrainImage" class="stack">
              3D Brain Image in NIFTI Format
            </label>
            <div class="file">
              <div class="fileButton" onclick="getFile(event)">Browse...</div>
              <input class="fileInput" type="text" name="brainImage" id="3DBrainImage" placeholder="No file selected."
                required autocomplete="off" onkeypress="return false;" onpaste="return false;" ondrop="return false;" />
            </div>
            <div class="error" id="3DBrainImageError" role="alert">Please enter a valid brain image</div>
            <figure class="hide" id="3DBrainImageFigure">
              <img id="3DBrainImageThumbnail" src=""
                alt="Preview of the original brain image (T1 or T2) that the user uploaded as a 1x3 grid of images of the middle planes in the sagittal, coronal, and axial views" />
              <figcaption>
                Preview of the original brain image as a 1x3 grid of images of the middle planes in the sagittal,
                coronal, and axial views
              </figcaption>
            </figure>
          </div>

          <div class="form-group">
            <label for="3DBrainLesionMask" class="stack">
              3D Brain Lesion Mask in NIFTI Format
            </label>
            <div class="file">
              <div class="fileButton" onclick="getFile(event)">Browse...</div>
              <input class="fileInput" type="text" name="brainLesionMask" id="3DBrainLesionMask"
                placeholder="No file selected." required autocomplete="off" onkeypress="return false;"
                onpaste="return false;" ondrop="return false;" />
            </div>
            <div class="error" id="3DBrainLesionMaskError" role="alert">Please enter a valid lesion mask</div>
          </div>
          <div class="third form-group">
            <label for="brainType" class="stack">
              <span>Select type of brain image:</span>
              <select name="type" id="brainType" onchange="setInputData(event)" required>
                <option hidden disabled selected value> -- select an option -- </option>
                <option value="T1w">T1w</option>
                <option value="T2w">T2w</option>
              </select>
            </label>
            <div class="error" id="brainTypeError" role="alert">Please select the brain type</div>
          </div>
          <h4>Subject data</h4>
          <div class="form-group">
            <label for="subjectID" class="stack">
              Subject ID:
              <strong><span aria-label="required" class="required">*</span></strong>
            </label>
            <input type="text" name="subject" id="subjectID" placeholder="e.g. CC00034XX09"
              onchange="setInputData(event)" pattern="[a-zA-Z0-9]+" required />
            <div class="error" id="subjectIDError" role="alert">Please enter a valid subject id. Only letters and
              numbers allowed. No special characters and no spaces</div>
          </div>
          <div class="form-group">
            <label for="gestationalAge" class="stack">
              Subjects gestational age, in weeks:
              <strong><span aria-label="required" class="required">*</span></strong>
            </label>
            <input type="number" step="0.01" placeholder="e.g. 37.67" name="gestation" id="gestationalAge"
              onchange="setInputData(event)" required />
            <div class="error" id="gestationalAgeError" role="alert">Warning: Age is outside of 28-44 weeks.
              Registration to template may be poor. Check registration quality in external
              image viewer.</div>
          </div>
        </form>
        <form id="form1a">
          <h4>Image Data</h4>
          <div class="form-group">
            <label for="lesionImage" class="stack">
              Lesion image already warped to template space
            </label>
            <div class="file">
              <div class="fileButton" onclick="getFile(event)">Browse...</div>
              <input class="fileInput" type="text" name="lesionImage" id="lesionImage" placeholder="No file selected."
                required autocomplete="off" onkeypress="return false;" onpaste="return false;" ondrop="return false;" />
            </div>
            <div class="error" id="lesionImageError" role="alert">Please enter a valid lesion image</div>
          </div>

          <h4>Subject data</h4>
          <div class="form-group">
            <label for="subjectIDA" class="stack">
              Subject ID:
              <strong><span aria-label="required" class="required">*</span></strong>
            </label>
            <input type="text" name="subject" id="subjectIDA" placeholder="e.g. CC00034XX09"
              onchange="setInputData(event)" pattern="[a-zA-Z0-9]+" required />
            <div class="error" id="subjectIDAError" role="alert">Please enter a valid subject id. Only letters and
              numbers allowed. No special characters and no spaces</div>

          </div>
          <div class="form-group">
            <label for="gestationalAgeA" class="stack">
              Age of template to which lesion image is warped, in weeks:
              <strong><span aria-label="required" class="required">*</span></strong>
            </label>
            <input type="number" step="0.01" placeholder="e.g. 37.67" name="gestation" id="gestationalAgeA"
              onchange="setInputData(event)" required />
            <div class="error" id="gestationalAgeAError" role="alert">Warning: Age is outside of 28-44 weeks.
              Registration to template may be poor. Check registration quality in external
              image viewer.</div>
          </div>
        </form>
        <form id="generateDisconnectomeForm">
          <h2>Subject warped to age matched template <span class="label success">Success</span></h2>
          <div id="previewResultImages" class="tabs three">
            <input id='tab-1' type='radio' name='tabgroupB' checked />
            <label class="pseudo button toggle" for="tab-1">Aligned Image Pair</label>
            <input id='tab-2' type='radio' name='tabgroupB'>
            <label class="pseudo button toggle" for="tab-2">Lesion on Original Brain Image</label>
            <input id='tab-3' type='radio' name='tabgroupB'>
            <label class="pseudo button toggle" for="tab-3">Lesion on Age Matched Template</label>
            <div class="row">
              <figure>
                <img class="previewImage" id="plotAlignedImagePair" src=""
                  alt="age-matched template image and the warped brain image beside each other to ensure they are aligned. This is to check the result of the first warp step" />
                <figcaption>
                  age-matched template image and the warped brain image beside each other to ensure they are aligned.
                  This
                  is to check the result of the first warp step
                </figcaption>
              </figure>

              <figure>
                <img class="previewImage" id="lesionOnOriginalTemplateClusters" src=""
                  alt="Preview the original label image overlaid on the original brain image" />
                <figcaption>
                  Preview the original label image overlaid on the original brain image.
                </figcaption>
              </figure>

              <figure>
                <img class="previewImage" id="lesionOnAgeMatchedTemplateClusters" src=""
                  alt="Preview the warped label image overlaid on the age-matched template image" />
                <figcaption>
                  Preview the warped label image overlaid on the age-matched template image.
                </figcaption>
              </figure>
            </div>
          </div>
        </form>
        <div id="result">
          <h2>Generated Disconnectome <span class="label success">Success</span></h2>
          <figure class="hide">
            <img id="plotDisconnectomeAtLesionCentroids" src=""
              alt="Image showing Disconnectome map overlaid on the 40w template, and the lesion map warped to the 40w template" />
            <figcaption>
              Disconnectome map overlaid on the 40w template, and the lesion map warped to the 40w template
            </figcaption>
          </figure>
        </div>
      </article>
      <aside class="container card output">
        <header>
          <h2>Current Run Data</h2>
        </header>
        <div class="">
          <h3>Input Data</h3>
          <details name="inputData" class="hide">
            <summary class="grayscale">Original 3D Brain Image</summary>
            <p id="brainImageInput"></p>
          </details>
          <details name="inputData" class="hide">
            <summary class="grayscale">Original 3D Brain Lesion Mask</summary>
            <p id="brainLesionMaskInput"></p>
          </details>
          <details name="inputData" class="hide">
            <summary class="grayscale">Lesion Image already warped</summary>
            <p id="lesionInput"></p>
          </details>
          <details name="inputData" class="hide">
            <summary class="grayscale">3D Brain Image Type</summary>
            <p id="typeInput"></p>
          </details>
          <details name="inputData" class="hide">
            <summary class="grayscale">Subject ID</summary>
            <p id="subjectInput"></p>
          </details>
          <details name="inputData" class="hide">
            <summary class="grayscale">Subjects gestational age, in weeks</summary>
            <p id="ageInput"></p>
          </details>

          <h3>Output data</h3>
          <details name="outputData" class="hide">
            <summary class="grayscale">input brain image warped to age-matched template</summary>
            <p id="brainImageWarpedOutput"></p>
          </details>
          <details name="outputData" class="hide">
            <summary class="grayscale">input lesion image warped to age-matched template</summary>
            <p id="lesionImageWarpedOutput"></p>
          </details>
          <details name="outputData" class="hide">
            <summary class="grayscale">age-matched template image(fixed image for warp step)</summary>
            <p id="ageMatchedTemplateOutput"></p>
          </details>
          <details name="outputData" class="hide">
            <summary class="grayscale">disconnectome map in 40w template space</summary>
            <p id="disconnectomeOutput"></p>
          </details>
          <details name="outputData" class="hide">
            <summary class="grayscale">lesion image in 40w template space</summary>
            <p id="lesionImageIn40wOutput"></p>
          </details>
          <details name="outputData" class="hide">
            <summary class="grayscale">40w template image</summary>
            <p id="40wTemplateImageOutput"></p>
          </details>
        </div>
      </aside>
      <footer class="">
        <p>Disconnectome was created by <a href="#" target="_blank">Steven Ufkes</a> with collaboration with the <a
            href="https://datasciences.utoronto.ca/research-software-development-support-program/" target="_blank">DSI
            research software
            development program</a> and is licensed under the GNU GPLv3 license. <a
            href="https://github.com/sufkes/neonatal_disconnectome" target="_blank">Source code for this site</a>
        </p>
      </footer>
    </main>
  </div>
</body>
<script src="js/script.js"></script>

</html>
